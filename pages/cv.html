<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Morten Lysgaard">
  <meta name="author" content="Morten Lysgaard">
  <title>CV</title>
  <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
              showMathMenu: false,
              jax: ["input/TeX","output/CommonHTML"],
              extensions: ["tex2jax.js"],
              messageStyle: "none",
                tex2jax: {
                  processEscapes: true,
                  ignoreClass: "tex2jax_ignore",
                  processClass: "math"
                },
              TeX: { 
                extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js","autobold.js"],
                Macros: { 
                    R: '{\\mathbb{R}}', 
                    N: '{\\mathbb{N}}', 
                    Z: '{\\mathbb{Z}}', 
                    C: '{\\mathbb{C}}', 
                    F: '{\\mathbb{F}}', 
                    argmin: '{\\mathop{\\operatorname*{arg\\,min}}}',
                    argmax: '{\\mathop{\\operatorname*{arg\\,max}}}',
                    mex: '{\\mathop{\\operatorname{mex}}}', 
                    lcm: '{\\mathop{\\operatorname{lcm}}}',
                    bigtriangleright: '{\\mathop{\\Large \\triangleright}}',
                    bigtriangleleft: '{\\mathop{\\Large \\triangleleft}}',
                    set: ['\\left\\{ #1 \\right\\}',1],
                    floor: ['\\left\\lfloor #1 \\right\\rfloor',1],
                    ceil:  ['\\left\\lceil #1 \\right\\rceil',1],
                    abs:  ['\\left| #1 \\right|',1]
                 } 
                },
                "HTML-CSS": { fonts: ["STIX"] }
            });
        </script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/css/default.css" />

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-24607697-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-24607697-1');
  </script>

</head>

<body class="tex2jax_ignore">
  <header class="hide-on-print">
    <div id="blog-title">
      <a href="/">Morten Lysgaard</a>
    </div>
    <nav>
      <ul style="display: inline-block;">
        <li><a href="/">Home</a></li>
        <!--li><a href="/pages/cv.html">CV</a></li-->
        <li><a href="/pages/trajectory-optimization-toolbox.html">Trajectory Optimization Toolbox</a></li>
        <li><a href="/pages/robotics-simulator.html">Robotics Simulator</a></li>
        <li><a href="/posts.html">Posts</a></li>
        <!--li><a href="/archive.html">Archive</a></li-->
      </ul>
    </nav>
  </header>
  <article>
    <h1 id="article-title">CV</h1>
    <h1 id="introduction"><span class="header-section-number">1</span> Introduction</h1>
<p>A cheerful pragmatic. Enjoys working with other people on complex problems. Very wide field of interest. Software, maths, physics, robotics, all aspects of engineering. Seeks demanding work and interesting people! Skilled programmer, software architect and technical leader. I really like the process of recruiting to build a well balanced team, on-boarding, creating a good software engineering culture, and then lead the team to a common technical goal.</p>
<p>I am an engineer and applied researcher at heart. After some time doing mostly technical leadership, I am now looking for a more engineering/research/tech-lead heavy position within the fields of my expertise:</p>
<ul>
<li>Control systems</li>
<li>Estimation</li>
<li>Optimization</li>
<li>3D perception</li>
<li>hard real-time systems</li>
<li>modeling and numerical simulation, especially PDEs, ODEs, DAEs and rigid-body dynamics</li>
</ul>
<p>After 8 years in the robotics industry, and delivering several systems, I am very aware of the challenges of deploying robotics systems in the real world. This makes me very well equipped to develop systems that actually work, are robust, cheap and most importantly, delivered on time.</p>
<h1 id="key-qualifications"><span class="header-section-number">2</span> Key qualifications:</h1>
<ul>
<li>Leadership of technical teams, technical project management, personnel management.</li>
<li>Creating a good engineering culture, building small high performing teams.</li>
<li>Experience with working with most types of engineers/researchers: field engineers, development, R&amp;D, theoretical research and scientists, mechanical, electrical, software, structural.</li>
<li>Software design, architecture, planning and testing.</li>
<li>Robotics, estimation, control, optimization, mathematics, physics, mathematical modeling, simulation, real-time systems.</li>
<li>Systems programming, library development.</li>
<li>Design of systems with very high reliability, even systems which can do physical harm, like drone autopilot and control systems.</li>
</ul>
<h1 id="experience"><span class="header-section-number">3</span> Experience</h1>
<ul>
<li>VP Software &amp; Systems Engineering, Nordic Unmanned, Sept 2019 - Present</li>
<li>CTO and co-founder, The Staaker Company, Sept 2014 - Sept 2019</li>
</ul>
<h1 id="education"><span class="header-section-number">4</span> Education</h1>
<ul>
<li>Masters in Applied Mathematics and Physics from <a href="https://www.ntnu.no">Norwegian University of Science and Technology</a>, 2010-2015
<ul>
<li>Focus on applied mathematics, modeling of physical systems, simulation and numerics.</li>
<li>PDEs, ODEs, DAEs, how to model these numerically and solve them efficiently</li>
<li>Masters thesis in computational fluid dynamics, where I developed a simulation of the electrocoalecense happening in an crude oil seawater separator used on oil platforms. This work was implemented in FORTRAN, and used a novel combination of an eulerian simulation of the fluids, together with an lagrangian (immersed boundary) method for describing the interface between oil and water.</li>
</ul></li>
<li>Exchange to <a href="https://ethz.ch/en.html">ETH ZÃ¼rich</a>, Switzerland, in 2014
<ul>
<li>Performance of low level numerical code on modern CPU-architectures, hyperbolic PDEs, numerical weather forecasting, GP-GPU processing.</li>
</ul></li>
<li>Exchange to Queensland University of Technology, Brisbane Australia in 2013
<ul>
<li>Modern control systems, mathematical modeling of biological systems, surf and sun!</li>
</ul></li>
</ul>
<h1 id="management"><span class="header-section-number">5</span> Management</h1>
<p>In Nordic Unmanned, I have been so lucky that have been able to recruit my own software development team and lead them. I have had personnel responsibility as well</p>
<h1 id="technical-leadership"><span class="header-section-number">6</span> Technical Leadership</h1>
<p>As CTO in The Staaker Company, we climbed the ladder from breadboards, loose wires and Arduino code up to a injection molded body, custom made PCBs, C++ firmware with reproducible builds, high code quality, and end-user product performance.</p>
<p>I have lead projects developing everything from batteries to production lines, robotic arms for mass calibration of drones, hard-real-time estimation and control stack, design of discrete state machine system in the Staaker drone. I like to work with engineers, because in my heart, I am an engineer. I love the first principles, reason-based way of getting</p>
<p>In Nordic Unmanned, I have gotten the opportunity to lead technical teams in a larger organization</p>
<h1 id="robotics-maths-physics-sensors-physics-modeling-simulation-etc."><span class="header-section-number">7</span> Robotics, maths, physics, sensors, physics modeling, simulation etc.</h1>
<h1 id="programming"><span class="header-section-number">8</span> Programming</h1>
<p>I have been programming since i was 12 years old and bought a LEGO Mindstorms set. Discovered Linux when I was 14, and have only been using it since. I have programmed large complex systems in:</p>
<ul>
<li>Languages: Rust, C++, Python, Haskell</li>
<li>Build systems: CMake, Make, Cargo, Meson, Stack, Pip + virtualenv</li>
<li>Computer: Everything from single core STM32 MCU running FreeRTOS, via 128-core SMP Linux machines up to large 1000-core MPI clusters for scientific computing.</li>
<li>OS: Linux, FreeRTOS, POSIX, custom bare metal code without OS</li>
<li>VCS system: GIT</li>
<li>CI: GitHub Actions / GitLab CI / JetBrains Team City</li>
</ul>
<p>I am a programming language nerd, and on my spare time I develop my own compilers for pure functional reactive programs in Haskell. I am comfortable in just about any tech-stack, but as I have explored the world of programming I have found that my mind is better at designing large systems using statically typed languages. Dynamic languages I mostly use for smaller tooling, that does not need to scale.</p>
<p>I have a lot experience with Linux, POSIX systems. Reading man pages, coding against C-APIs, using system calls, threading, mutexes, semaphores, condition variables, creating libraries for other programmers to consume etc. I understand graphics pipelines, the vertex and index buffers, shaders, the specific constraints using a GPU put on the application code.</p>
<h1 id="management-1"><span class="header-section-number">9</span> Management</h1>
<p><details> <summary> <span class="detail-header">Recruiting</span> As VP Software &amp; Systems Engineering in Nordic Unmanned. I had the opportunity to build a dedicated drone development software team in our offices in Oslo. </summary></p>
<p>When moving over to Nordic Unmanned we had a single SW-developer, in addition to me. To the project deadlines in both internal and external projects, it was clear that we needed more software development manpower. I took the task of recruiting 3 additional software developers. The recruitment pipeline was designed as follows:</p>
<ul>
<li>The job ads had a clear technical focus, emphasizing how much freedom, and responsibility the positions would give.</li>
<li>The ads were marketed towards young talented developers with 2 years in the industry.</li>
<li>A detailed questionnaire was created required to fill out for all applicants, this worked as a natural filter, as well as giving lots of insights into the candidate very early in the process.</li>
<li>This application process made it quite challenging to apply if you did not have the right skills, but if you had the right skills, it would be quite easy to show it.</li>
<li>Based on the applications, the signal to noise ratio was very good. Around 10% of the applicants were spot on and had great applications.</li>
<li>All of these were interviewed, and out of them 3 applicants clearly stood out.</li>
<li>After follow up interviews, background checks etc. they were hired.</li>
<li>The whole process took 4 months, and had very low costs, as there were no recruiters to pay.</li>
<li>The quality of the hires was very high, both on a technical level, but also on the ability to work together as a team.</li>
<li>The salary expectations of the hires were average. The process was focused hiring people with 2 years in industry, that had jobs were they did not get out their potential.</li>
</ul>
<p>When you are starting up a new department, company, or team, the initial hires are very important. This process worked remarkably well for creating a founding team. It does not scale to recruiting a 100 engineers, but usually, when you are making something cutting edge, it is better with a few very good engineers, than a lot of average ones. </details></p>
<p><details> <summary> <span class="detail-header">Personnel responsibility</span> As VP Software &amp; Systems Engineering in Nordic Unmanned I had personnel responsibility for my team. </summary></p>
<p>During day to day work, I helped my team manage their work life balance. Personal issues etc. I have experienced the effect of &quot;just working hard&quot; during the early days of The Staaker Company, and seen what it does to the long term productivity of a team. I believe that high performing teams, it is possible to give a lot of flexibility to the employees without it being misused. After all, they have chosen to work for this company and team themselves, among so many other exciting opportunities. Give them flexibility, and they will be flexible and dedicated in return when the job requires it. </details></p>
<h1 id="leadership"><span class="header-section-number">10</span> Leadership</h1>
<p><details> <summary id="leading-a-team"> <span class="detail-header">Leading a team</span> As VP Software &amp; Systems Engineering in Nordic Unmanned I had the privilege to lead my team to our goals set by our CTO and our business and sales units. </summary></p>
<p>Both in The Staaker Company and in Nordic Unmanned, my job has been to lead the team towards our business goals. A lot of this has been about clearly translating between business goals and technical goals. As long as the technical goals are clear, and their connection to the business is explicitly defined, things go smooth.</p>
<p>I am used to work on both sides of business and development, and can fluidly change role given what is needed for the current situation. </details></p>
<p><details> <summary> <span class="detail-header">Project management</span> I have worked with project management all the way from an informal student startup up to an enterprise organization that is Nordic Unmanned. Each phase of development and size of organization has it's characteristics, strengths and weaknesses. </summary> </details></p>
<h1 id="technical-projects"><span class="header-section-number">11</span> Technical projects</h1>
<p><details> <summary><span class="detail-header">Drone Simulator</span> One of the main challenges with developing drones, is the amount of physical testing required. Back in 2015-2016 when we were in the most intense period of development of the Staaker drone, I realized that if we could make our testing and verification more effective, we could improve our development speed drastically. This spawned the simulator project: </summary></p>
<h3>
Motivation
</h3>
<p></details></p>
<p><details> <summary><span class="detail-header">Nordic Unmanned Railway Robot Phase 1</span> <iframe style="width: min(100%, 560px); height: min(100%, 315px);" src="https://www.youtube-nocookie.com/embed/srBggRXdrAM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>
<p>This project was an initial technical demonstrator. 2 goals were set:</p>
<ol type="1">
<li>Create a drone platform that is physically capable of driving on rails and flying, as well as landing on them.</li>
<li>Demonstrate an automated landing system that can land a drone on a rail autonomously. </summary></li>
</ol>
<h3>
Drone platform
</h3>
<p>For the drone platform, our BG200 platform was adapted. Here my responsebility was an ensuring the following properties of the platform</p>
<ul>
<li>Flight characteristics able to land.</li>
<li>Flight endurance to be be able to jump between tracks many times.</li>
<li>Rail driving endurance of &gt;100km.</li>
<li>Feasible placement for all avionics, computer vision and onboard computing systems</li>
<li>Compromize between fligth and rail running performance</li>
</ul>
<p>As the project had constraints, we could not change the BG200 frame design, only add to it. The end result is a carefull compromize between all the performance factors, complexity and cost.</p>
<h3>
Rail landing demonstrator
</h3>
<p>The goal of this subproject was to demonstrate that a drone can:</p>
<ul>
<li>Autonomously navigate to a rail.</li>
<li>Localize the rail using local vision sensors.</li>
<li>Plan and execute a smooth track-landing using local vision sensors.</li>
</ul>
<p>To ease the development, a 500mm size drone was used as a research vehicle. The tech stack was the following:</p>
<ul>
<li>500mm size drone</li>
<li>Staaker Autopilot</li>
<li>Small onboard ARM64 Linux computer</li>
<li>Intel RealSense stere depth camera for visual input data</li>
</ul>
<p>The vision, estimation and control stack was fully implemented by me, and consisted of the following C++ pipeline. The RealSense camera would be configured for minimal latency and filtering. A custom C++ RANSAC library was developed, and hand tuned for 20Hz performance on a very weak ARM64 linux single board computer. Using the RANSAC library, I designed a chain of RANSAC filters to isolate the rails from all the other points in the pointcloud with very high robustness, low latency, and 20Hz troughput. Because the method was purely based on the geometry of the rails, it was extremely robust to common issues with vision systems. It would easily handle any visual changes like lighting conditions, varying degrees of rust, leaves on the track etc. Since it was based on RANSAC filtering, the algorithm was also very robust agains noise in the point cloud data, things like shrubs, leaves, straws, signpoles etc. would not confuse the filter.</p>
<p>Using 3D transofrmations the Linux computer would continously produce a stream of 3D-point-pairs, which represented the current position of the rail in the drones body frame. This stream would then be feed into a custom rail-landing control system. This system would home the drone on the rail, and a control law would lower the drone carefully, while maintaining contol of x,y-position and yaw. The control law was designed to be robust in such a way that if the drone was divering from its planned path, it would ascend untill it's margin for error was large enough to retry.</p>
<p>The control signal from the rail-landing controller would be feed as low level NED-velocity commands to the Staaker Autopilot system. And the Staaker Autopilot system would execute these using its control system to safely land. </details></p>
<p><details> <summary><span class="detail-header">The Staaker Drone state estimator</span></p>
<p>For the Staaker and Nordic Unmanned drones, I designed and implemented the state estimator. The design is an flexible extended kalman filter, running hard real-time on an STDM32F4. I estimates all states of the drone at 500Hz.</summary></p>
<h3>
General design
</h3>
<p>The Staaker Drone uses an extended kalman filter as its state estimator. The state contains position, velocity, acceleration, attitude modelled as a quaternion and 3-axis gyro-bias. The control input tho the filter is the gyroscope and body frame accelerometer measurements. The kalman filter supports several different types of measurements (kalman updates):</p>
<ol type="1">
<li>World-frame-yaw heading</li>
<li>Body acceleration</li>
<li>Combinated body acceleration north-east heading</li>
<li>Altitude measurement (barometer or GPS-height)</li>
<li>Combined GPS-north-east-position, altitude, NorthEastDown-velocity, body-acceleration and word-frame-yaw heading</li>
</ol>
<p>The reason for this many types of measurements is that data arrives at different rates. The sensors are ordered from slowes to fastes:</p>
<ul>
<li>GPS: 5-10Hz, not hard-real-time timing</li>
<li>Barometer/compass: ~20Hz sampling</li>
<li>Accelerometer/gyroscope: 500Hz sampling</li>
</ul>
<p>At each update of the kalman filter, the readyness of new sensor data is checked for each sensor.</p>
<ul>
<li>If GPS data is available, the most expensive and full update step is run, 5.</li>
<li>Else if magnetometer data is available, update 3. is run</li>
<li>If barometer data is available, update 4.</li>
<li>Last, if accelerometer data is available, and it has not yet been &quot;consumed&quot; by any of the other update steps, update 2. is run.</li>
</ul>
<p>With this design, the kalman filter can estimate and integrate data from all the different sensors, in a consistent manner, at the highest possible rate, 500Hz, without having to to hacks like having an integrating observer running ahead in time of the kalman filter.</p>
<p>A critical point in the design of any kalmin filter that contains attitude is how to parametrize it. In my work I have choosen that the kalman filter estimates a linearized 3-axis error angle, of the current non-linear quaternion state. This is different from linearizing the quaternion equations and directly estimating the next 4 quaternion coordinates. The reason for this is that attitude-quaternions require that <span class="math inline">\(|q|=1\)</span>, which is a constraint the kalman filter is not able to take into account. This means that any extended kalman filter which is estimating directly an quaternions, DCM-matrices or similar will end up estimating poorly, especially for very dynamic systems, as the extended kalman filter ends up with an estimate where <span class="math inline">\(|q|\ne1\)</span>.</p>
<h3>
Software implementation
</h3>
<p>The kalman filter is required to run at 500Hz on a tiny STM32F4 chip. A normal naive implementation in C++ would have a hard time getting close to just 50Hz update rate on such a processor. To enable this fast enough numerics on such a small computing budget, I developed an optimizing symbolic math based numerical compiler in Python using SymPy. The compiler takes as input the symbolic equations for the movement of a drone, and outputs a C-file, containing no dynamic memory, no loops, no unbounded control logic. One of the key innovations for this was to find a general closed form solution for the covariance update step in the kalman equations and compressing this expression down to a code size that quickly will execute on a microcontroller.</p>
<p>The compiler is fully integrated into the drone build system, so chaning any of the declarative model-input files triggers a full rebuild of the whole kalman filter stack. </details></p>
<p><details> <summary><span class="detail-header">The Staaker Drone control system</span></p>
<p>For the Staaker and Nordic Unmanned drones, I designed and implemented the control system. The design is a classic cascaded PID-loop design, with a complex mapping between desired accelerations and desired attitude. The control stack is running hard real-time on an STDM32F4. I consumes estimates and refernce setpoints and controls the drone motors at 500Hz.</summary></p>
<h3>
General design
</h3>
<p>The Staaker drone control system is a classic cascaded PID design. For position, the implementation is straight forward. For velocity, if saturation is reached, a heuristic prioritizing altitude is used. This saves the drone from crashing into the ground if it is given velocity setpoints it can not reach. Acceleration is mapped to orientation and thrust, by solving the physical model of the forces on the craft for orientation. Orientation uses a a nonlinear control law. It takes into account that roll and pitch moments are much easier to generate than yaw. It also takes into account the existing momentum of the craft. The generated rate setpoint from the orientation control law is used by the rate PID controller.</p>
<h3>
Motor saturation handling
</h3>
<p>Quadcopter controller design would be easy, if it wasn't for saturation. The reason is that in the control system, information flows from the slow dynamics, to the fast dynamics. Position -&gt; velocity -&gt; attitude -&gt; rates -&gt; motor setpoints. First when some motor setpoints have been computed, you will know if any of the motors will saturate. If none of the motors saturate, you now have the problem of propagating backwards trough the control laws the saturation, trying to change the setpoints so that the saturation disappears.</p>
<p>In the Staaker drone, yaw-rate is always sacrificed first, if saturation is detected. This is because a quadrotor can fly safely as long as it is able to measure its yaw, while it does not need to control it. A fascinating example of this is in this video:</p>
<iframe src="https://www.youtube-nocookie.com/embed/t369aSInq-E?start=14" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p></details></p>
<p><details> <summary> <span class="detail-header">The Staaker Drone embedded system architecture</span> The Staaker Drone Autopilot system runs on an embedded MCU, on STM32F4/STM32F7. As CTO in The Staaker Company, and VP Software &amp; Systems Engineering in Nordic Unmanned, I both oversaw the overall design and architecture of our embedded system. </summary></p>
<h3>
Overall architecture
</h3>
<p>When starting The Staaker Company, we decided for using C++ as our main language. </details></p>
<p><details> <summary><span class="detail-header">High efficiency low-latency live video streaming</span> To control a drone, an operator depends on a live video stream. I designed and implemented the software stack that does videostreaming in Nordic Unmanneds Staaker drones.</summary></p>
<h3>
General design goals
</h3>
<p>Key design goal for the video streaming stack was the following:</p>
<ul>
<li>Low end-to-end latency. From the camera grabs a frame untill it is visible on the screen on the ground, there should be no more than 60-70ms for the operator to feel he still has control of the craft.</li>
<li>Low bandwith. Long range together with maximum power requirements on radio equipment means that the received signal from the drone is weak. This leads to a low maximum bandwidth. We optimized or systems to carry 2 video streams within 1.5megabit of bandwith.</li>
<li>High tolerance to network packet loss</li>
<li>High tolerance to network packet jitter</li>
<li>High energy/compute efficiency</li>
</ul>
<h3>
Implementation
</h3>
<p>To get low end-to-end latency, there can be very few buffers in the pipeline. The only places where data is buffered in the solution is inside the video encoder, which requires at least 1 single frame delay to be able to do delta encoding, and withing the reciving jitterbufer, that handles network packet reordering. Another critical part of the latency was to use hardware accelerated encoding and tune the encoder for minimal latency.</p>
<p>To get the required energy/compute efficiency using VA-API was choosen. This offloads the hard work of H264 video encoding to the underlying graphics hardware.</p>
<p>To handle network packet jitter, a jitterbuffer was used on the receiver side. To handle packet loss, additional forward error correction coding is used on the sender side, and the accompanying FEC-decoding on the reciving side. This lets the link handle X% packet loss, at the cost of X% extra bandwidth, without any loss of information on the receiving side.</p>
<p>The system was implemented in the Rust programming language, using the gstreamer library. </details></p>
<p><details> <summary><span class="detail-header">Long Range Mesh Radio system</span> For several of our missions in Nordic Unmanned. Dedicated long range radio links are required. These are used for streaming live data down to the operator as well as controling the drone. I have worked with the selection, testing and verification of the radio system we used.</summary></p>
<h3>
Specification
</h3>
<h3>
Testing and verification
</h3>
<p></details></p>
<!--details>
<summary><span class="detail-header">Nordic Unmanned RailRover</span>
todo
</details-->
<h1 id="skills-todo"><span class="header-section-number">12</span> Skills TODO</h1>
<ul>
<li>Software architecture</li>
<li>Numerical analysis</li>
<li>Mathematical modeling, physics, and simulation</li>
<li>Estimation and control</li>
<li>Hardware and software in the loop simulation</li>
<li>Library development</li>
</ul>

  </article>
  <footer class="hide-on-print">Â© 2011 -
    <script>document.write(new Date().getFullYear())</script> Morten Lysgaard. Licensed under GPL-v3 or later unless
    otherwise specified.
  </footer>

</body>

</html>

</html>